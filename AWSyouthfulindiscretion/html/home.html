<!DOCTYPE html>
<html>
<head>
<script type='text/javascript' src='../js/add.js'></script>
<script type='text/javascript' src='../js/create.js'></script>
<script type='text/javascript' src='../js/delete.js'></script>
<script type='text/javascript' src='../js/getVideoSegment.js'></script>
<script type='text/javascript' src='../js/getPlaylist.js'></script>
<script type='text/javascript' src='../js/api.js'></script>
<link rel="stylesheet" type="text/css" href="home.css">


<script type="text/javascript">
	function initialize() {

		// get all of the playlists and video segments
		refreshPlaylistList();
		refreshVideoSegments();
		displayPlaylists();
	}
	/**
	 * Refresh constant list from server
	 *
	 *    GET list_url
	 *    RESPONSE  list of [name, value] constants 
	 */
	function refreshPlaylistList() {
		var xhr = new XMLHttpRequest();
		xhr.open("GET", listp_url, true);
		xhr.send();

		console.log("sent");

		// This will process results and update HTML as appropriate. 
		xhr.onloadend = function () {
			if (xhr.readyState == XMLHttpRequest.DONE) {
				console.log ("XHR:" + xhr.responseText);
				processListResponse(xhr.responseText);
			} else {
				processListResponse("N/A");
			}
		};
	}
	
	
	function refreshVideoSegments() {
		var xhr = new XMLHttpRequest();
		xhr.open("GET", listv_url, true);
		xhr.send();

		console.log("sent");

		// This will process results and update HTML as appropriate. 
		xhr.onloadend = function () {
			if (xhr.readyState == XMLHttpRequest.DONE) {
				console.log ("XHR:" + xhr.responseText);
				processResponseVs(xhr.responseText);
			} else {
				processResponseVs("N/A");
			}
		};
	}
	
	function displayPlaylists() {
		var xhr = new XMLHttpRequest();
		xhr.open("GET", listp_url, true);
		xhr.send();

		console.log("sent");

		// This will process results and update HTML as appropriate. 
		xhr.onloadend = function () {
			if (xhr.readyState == XMLHttpRequest.DONE) {
				console.log ("XHR:" + xhr.responseText);
				processDisplayResponse(xhr.responseText);
			} else {
				processDisplayResponse("N/A");
			}
		};
	}

	/**
	 * Respond to server JSON object.
	 *
	 * Replace the contents of 'constantList' with a <br>-separated list of name,value pairs.
	 */
	function processListResponse(result) {
		console.log("res:" + result);
		console.log("hello from the other side");
		// Can grab any DIV or SPAN HTML element and can then manipulate its contents dynamically via javascript
		var js = JSON.parse(result);
		var playlistList = document.getElementById('PlaylistList');

		var output = "";
		for (var i = 0; i < js.list.length; i++) {
			var playlistJson = js.list[i];
			console.log(playlistJson);

			var pid = playlistJson["id"];
			var pvideo = playlistJson["videoSegments"];
			var vidout = "";
			for (var j = 0; j<pvideo.length; j++) {
				if(!(pvideo[j]==(null))){
				var vidJson = pvideo[j];
				var url = vidJson["url"];
				vidout = vidout + "<video id=\"p"+i+"v"+j+"\" width=\"300\" height=\"220\" controls> <source src=\""+url+"\"type=\"video/ogg\"> </video>";
				}
				/**
				console.log(pvideo[j])
				var vidJson = pvideo[j];
				var url = vidJson["url"];
				vidout = vidout + "<video id=\"p"+i+"v"+j+"\" width=\"300\" height=\"220\" controls> <source src=\""+url+"\"type=\"video/ogg\"> </video>";
			*/
			}
			output = output + "<div id=\"playlist" + pid + "\"><b>Playlist "+pid+"</b> <button type=\"button\" onClick=\"JavaScript:handleDeleteClick(this)\">Delete Playlist</button> <br> <div class=\"playlist" + i + "vids\">" + vidout + "</div></div>";
			console.log("helooooooo");
		
		}

		// Update computation result
		playlistList.innerHTML = output;
	}
	 
	 /**
		 * Respond to server JSON object.
		 *
		 * Replace the contents of 'constantList' with a <br>-separated list of name,value pairs.
		 */
		function processResponseVs(result) {
			console.log("res:" + result);
			// Can grab any DIV or SPAN HTML element and can then manipulate its contents dynamically via javascript
			var js = JSON.parse(result);
			var constList = document.getElementById('VideoSegments');

			var output = "";
			for (var i = 0; i < js.list.length; i++) {
				var constantJson = js.list[i];
				console.log(constantJson);

				var actor = constantJson["actor"];
				var phrase = constantJson["phrase"];
				var url = constantJson["url"];
				var id = constantJson["id"];
				output = output + "<div id=\"vs" + actor + "" + phrase+ "\">" + "<video id=\"video1\" width=\"300\" height=\"220\" controls> <source src=\""+url+"\"type=\"video/ogg\" </video> </div>";
			}

			// Update computation result
			constList.innerHTML = output;
		}
		 
		 function processDisplayResponse(result) {
				console.log("res:" + result);
				// Can grab any DIV or SPAN HTML element and can then manipulate its contents dynamically via javascript
				var js = JSON.parse(result);
				var playlist = document.getElementById('PlaylistName');

				var output = "";
				for (var i = 0; i < js.list.length; i++) {
					var playlistJson = js.list[i];
					console.log(playlistJson);

					var pid = playlistJson["id"];
					var pvideo = playlistJson["videoSegments"];
					var vidout = "";
					output = output + "<div id=\"playlist" + pid + "\"><b>Playlist "+pid+"</b> <button type=\"button\" onClick=\"JavaScript:handleAppendClick(this)\">"+pid+"</button> <br>";
				}
				// Update computation result
				playlist.innerHTML = output;
		 }


</script>
</head>


<body onload="initialize()">
<body>
	<h1>Playlist App</h1>

	<h2>Playlists:</h2>
	<button type="button" onClick="JavaScript:handleCreateClick(this)">Create
		New Playlist</button>
		
	<!-- Displays the playlists -->

	<div id="PlaylistList"></div>


	<h2>Video Segments:</h2>

<!-- Displays the video segments-->
	<div id="VideoSegments"></div>
	

	<h3>Upload Video Segments</h3>

	<!--Upload video segments -->
	<form name="uploadFile" method="post">
		<input name="character" value="Character" /><input name="phrase"
			value="Phrase"/>
		<input id="fileupload" type="file" /> <input type="submit"
			value="Submit" id="submit"
			onClick="JavaScript:handleUploadVideoSegment" />
	</form>

	<h3>Search Video Segment</h3>
	<!-- Search for video segments  -->
	<form name="searchForm" method="post">
	<input name="character" value="Character" />
	<input name="phrase" value="Phrase" />
	<input type="button" value="Submit"
		onClick="JavaScript:SearchClick(this)">
	<div class="dropdown">
		<button class="dropbtn">Append VS</button>
		<div class="dropdown-content">
			<div id="PlaylistName"> </div>
		</div>
	</div>
	</form>

</body>
</html>
