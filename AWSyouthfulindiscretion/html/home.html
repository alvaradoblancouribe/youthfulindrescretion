<!DOCTYPE html>
<html>
<head>
<script type='text/javascript' src='../js/add.js'></script>
<script type='text/javascript' src='../js/create.js'></script>
<script type='text/javascript' src='../js/delete.js'></script>
<script type='text/javascript' src='../js/getVideoSegment.js'></script>
<script type='text/javascript' src='../js/getPlaylist.js'></script>
<script type='text/javascript' src='../js/api.js'></script>

<script type="text/javascript">
	function initialize() {

		// get all of the playlists (?) and video segments (?)
		refreshPlaylistList();
		refreshVideoSegments();
	}
	/**
	 * Refresh constant list from server
	 *
	 *    GET list_url
	 *    RESPONSE  list of [name, value] constants 
	 */
	function refreshPlaylistList() {
		var xhr = new XMLHttpRequest();
		xhr.open("GET", listp_url, true);
		xhr.send();

		console.log("sent");

		// This will process results and update HTML as appropriate. 
		xhr.onloadend = function () {
			if (xhr.readyState == XMLHttpRequest.DONE) {
				console.log ("XHR:" + xhr.responseText);
				processListResponse(xhr.responseText);
			} else {
				processListResponse("N/A");
			}
		};
	}
	
	
	function refreshVideoSegments() {
		var xhr = new XMLHttpRequest();
		xhr.open("GET", listv_url, true);
		xhr.send();

		console.log("sent");

		// This will process results and update HTML as appropriate. 
		xhr.onloadend = function () {
			if (xhr.readyState == XMLHttpRequest.DONE) {
				console.log ("XHR:" + xhr.responseText);
				processListResponseV(xhr.responseText);
			} else {
				processListResponseV("N/A");
			}
		};
	}

	/**
	 * Respond to server JSON object.
	 *
	 * Replace the contents of 'constantList' with a <br>-separated list of name,value pairs.
	 */
	function processListResponse(result) {
		console.log("res:" + result);
		// Can grab any DIV or SPAN HTML element and can then manipulate its contents dynamically via javascript
		var js = JSON.parse(result);
		var playlistList = document.getElementById('PlaylistList');

		var output = "";
		for (var i = 0; i < js.list.length; i++) {
			var playlistJson = js.list[i];
			console.log(playlistJson);

			var pid = playlistJson["id"];
			var pvideo = playlistJson["videoSegments"];
			var vidout = "";
			for (var j = 0; j<pvideo.length; j++) {
				var vidJson = pvideo[j];
				var url = vidJson["url"];
				vidout = vidout + "<video id=\"p"+i+"v"+j+"\" width=\"300\" height=\"220\" controls> <source src=\""+url+"\"type=\"video/ogg\"> </video>";
			}
			output = output + "<div id=\"playlist" + pid + "\"><b>Playlist "+pid+"</b> <button type=\"button\" onClick=\"JavaScript:handleDeleteClick(this)\">Delete Playlist</button> <br> <div class=\"playlist" + i + "vids\">" + vidout + "</div></div>";
		
		}

		// Update computation result
		playlistList.innerHTML = output;
	}
	 
	 /**
		 * Respond to server JSON object.
		 *
		 * Replace the contents of 'constantList' with a <br>-separated list of name,value pairs.
		 */
		function processListResponseV(result) {
			console.log("res:" + result);
			// Can grab any DIV or SPAN HTML element and can then manipulate its contents dynamically via javascript
			var js = JSON.parse(result);
			var constList = document.getElementById('VideoSegments');

			var output = "";
			for (var i = 0; i < js.list.length; i++) {
				var constantJson = js.list[i];
				console.log(constantJson);

				var actor = constantJson["actor"];
				var phrase = constantJson["phrase"];
				var url = constantJson["url"];
				var id = constantJson["id"];
				output = output + "<div id=\"vs" + actor + "" + phrase+ "\">" + "<video id=\"video1\" width=\"300\" height=\"220\" controls> <source src=\""+url+"\"type=\"video/ogg\" </video> </div>";
			}

			// Update computation result
			constList.innerHTML = output;
		}


</script>
</head>


<body onload="initialize()">
<body>
	<h1>Playlist App</h1>

	<h2>Playlists:</h2>
	<button type="button" onClick="JavaScript:handleCreateClick(this)">Create New Playlist</button>
	<!--  get and display the current playlists -->
	
	<div id="PlaylistList"></div>

	
	<h2>Video Segments:</h2>
	
	<div id="VideoSegments"></div>
	
	<h3>Upload Video Segments</h3>

	<!--Figure out the JavaScript:handleAddClick(this) for submiting a playlist  -->
	<form name="addForm" method="post">
		<input name="arg1" value="Character" /><input name="arg2"
			value="Phrase" onClick="JavaScript:handleAddClick(this)" />
	</form>
	<form id="uploadFile" method="post" action="#">
		<input id="fileupload" type="file" /> <input type="submit"
			value="Submit" id="submit" />
	</form>

	<h3>Search Video Segment</h3>
	<input name="arg1" value="Character" />
	<input name="arg2" value="Phrase" />
	<input type="button" value="Submit"
		onClick="JavaScript:handleSearchClick(this)">

</body>
</html>
